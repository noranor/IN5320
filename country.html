<! doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Mandatory Assignment 1.2</title>
        <style>
                h1{
                    font-family: Arial;
                    font-size: 2em;
                }
    
                h2{
                    font-family: Arial;
                    font-size: 1em;
                }
    
        </style>
    </head>
    <body>
        <header>
            <section>
                <h1>Countries</h1>
                <h2>Write some country names and watch the magic happen.</h2>
            </section>
        </header>

        <input type="country" name="userInput" id="userInput" placeholder="Country">
        <button onclick="addUserInput()">Add</button>
        <br>

        <input type="search" name="search" id="searchInput" placeholder="Search">
        <button onclick="searchFor()">Search</button>

        <ul id="countryList">
        </ul>

        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
        <script type="text/javascript">
                window.sessionStorage;

                let countryList = document.getElementById("countryList");
                let searchWord = document.getElementById("search");
                let inputArray = [];

                
                function addUserInput(){
                    let input = document.getElementById("userInput").value, 
                        //ul = document.getElementById("countryList"), 
                        li = document.createElement("li"), 
                        inputTxt = document.createTextNode(input);
                    
                    inputArray.push(input);
                    console.log(inputArray);
                    
                    const button = document.createElement("button");
                    button.innerHTML=" X";
                    
                    li.appendChild(inputTxt);
                    li.appendChild(button);
                    //used to be let ul
                    countryList.appendChild(li);
                    offlineStorage(inputArray, myFunction);

                    document.getElementById("userInput").value = "";

                    button.addEventListener("click", function(e){
                        button.parentNode.parentNode.removeChild(button.parentNode);
                        inputArray.splice(inputArray.indexOf(button.parentNode));
                        // Doesn't work
                        sessionStorage.removeItem(e)
        
                        console.log(inputArray);
                    });
                }

                function offlineStorage(inputArray, myFunction){
                    for(let i = 0; i < inputArray.length; i++){
                        console.log("Running myFunction, sessionStorage for " + inputArray[i]);
                        myFunction(inputArray[i]);
                    }
                }

                function myFunction(e){
                    if (typeof(Storage) !== "undefined") {
                         sessionStorage.setItem(e, JSON.stringify(e));  
                    } else {
                        alert("No web storage support.")
                    }
                }

                function searchFor(){
                    let searchWord = document.getElementById("searchInput");

                    for(let i = 0; i < countryList.length; i++){
                        console.log(i);
                        for(let j = 0; j < countryList[i].length; j++){
                            console.log(countryList[i][j])
                            if(countryList[i].charAt(j) == searchWord.charAt(j) && countryList[i].charAt(j+1) == searchWord.charAt(j+1) && countryList[i].charAt(j+2) == searchWord.charAt(j+2)){
                                return true;
                                console.log("Search for" + searchWord + " = true");
                            } else {
                                return false;
                            }
                        }
                    }
                }

        </script>
    </body>
</html>